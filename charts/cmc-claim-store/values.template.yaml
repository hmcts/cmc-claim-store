tags:
  cmc-claim-store-postgresql-pod: true
  cmc-citizen-frontend-pod: true
  cmc-ccd-stack: true
  postgresql-pod: false  # rpe-feature-toggle-api & ccd

postgresql:
  resources:
    requests:
      cpu: 25m
  initdbScripts:
    init.sql: |-
      CREATE USER claimstore WITH PASSWORD 'claimstore';
      CREATE DATABASE claimstore WITH OWNER = claimstore ENCODING = 'UTF-8' CONNECTION LIMIT = -1;
      CREATE USER cmc WITH PASSWORD 'cmc';
      CREATE DATABASE cmc WITH OWNER = cmc ENCODING = 'UTF-8' CONNECTION LIMIT = -1;
      CREATE USER features WITH PASSWORD 'features';
      CREATE DATABASE features WITH OWNER = features ENCODING = 'UTF-8' CONNECTION LIMIT = -1;
      CREATE DATABASE "data-store" WITH OWNER = hmcts ENCODING = 'UTF-8' CONNECTION LIMIT = -1;
      CREATE DATABASE "definition-store" WITH OWNER = hmcts ENCODING = 'UTF-8' CONNECTION LIMIT = -1;
  postgresqlUsername: hmcts
  postgresqlPassword: hmcts
  postgresqlDatabase: user-profile
  nameOverride: ccd-postgres  # because ccd wont work without specific name
  persistence:
    enabled: false

java:
  image: ${IMAGE_NAME}
  ingressHost: ${SERVICE_FQDN}
  applicationPort: 4400
  cpuRequests: 25m
  keyVaults:
    cmc:
      resourceGroup: cmc
      secrets:
        - AppInsightsInstrumentationKey
        - citizen-oauth-client-secret
        - claim-store-s2s-secret
        - anonymous-caseworker-username
        - anonymous-caseworker-password
        - system-update-username
        - system-update-password
        - notify-api-key
  environment:
    IDAM_S2S_AUTH_URL: http://rpe-service-auth-provider-aat.service.core-compute-aat.internal
    SEND_LETTER_URL: http://rpe-send-letter-service-aat.service.core-compute-aat.internal
    IDAM_API_URL: https://idam-api.aat.platform.hmcts.net
    PDF_SERVICE_URL: http://cmc-pdf-service-aat.service.core-compute-aat.internal
    DOCUMENT_MANAGEMENT_URL: false
    REFORM_TEAM: cmc
    REFORM_SERVICE_NAME: claim-store
    REFORM_ENVIRONMENT: preview
    LOG_LEVEL: DEBUG
    CLAIM_STORE_DB_HOST: ${SERVICE_NAME}-ccd-postgres
    CLAIM_STORE_DB_PORT: 5432
    CLAIM_STORE_DB_USERNAME: claimstore
    CLAIM_STORE_DB_NAME: claimstore
    CMC_DB_HOST: ${SERVICE_NAME}-ccd-postgres
    CMC_DB_PORT: 5432
    CMC_DB_USERNAME: cmc
    CMC_DB_NAME: cmc
    SPRING_MAIL_HOST: mta.reform.hmcts.net
    SPRING_MAIL_PORT: 25
    SPRING_MAIL_TEST_CONNECTION: false
    SPRING_MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_ENABLE: true
    SPRING_MAIL_PROPERTIES_MAIL_SMTP_SSL_TRUST: mta.reform.hmcts.net
    CLAIM_STORE_TEST_SUPPORT_ENABLED: true
    FEATURE_TOGGLES_EMAILTOSTAFF: true
    FEATURE_TOGGLES_CCD_ENABLED: true
    FEATURE_TOGGLES_CCD_ASYNC_ENABLED: false
    DOCUMENT_MANAGEMENT_CASEWORKERROLE: caseworker-cmc
    CORE_CASE_DATA_API_URL: http://${SERVICE_NAME}-data-store-api
    FRONTEND_BASE_URL: https://www-${SERVICE_FQDN}
    RESPOND_TO_CLAIM_URL: https://www-${SERVICE_FQDN}/first-contact/start
    STAFF_NOTIFICATIONS_RECIPIENT: civilmoneyclaims+staff-int-tests@gmail.com
    STAFF_NOTIFICATIONS_SENDER: noreply@reform.hmcts.net
    RPA_NOTIFICATIONS_SENDER: noreply@reform.hmcts.net
    RPA_NOTIFICATIONS_SEALEDCLAIMRECIPIENT: civilmoneyclaims+rpa-claim-issued@gmail.com
    RPA_NOTIFICATIONS_MORETIMEREQUESTEDRECIPIENT: civilmoneyclaims+rpa-more-time-requested@gmail.com
    RPA_NOTIFICATIONS_RESPONSERECIPIENT: civilmoneyclaims+rpa-defence-response@gmail.com
    RPA_NOTIFICATIONS_COUNTYCOURTJUDGEMENTRECIPIENT: civilmoneyclaims+rpa-county-court-judgement@gmail.com
    RPA_NOTIFICATIONS_PAIDINFULLRECIPIENT: civilmoneyclaims+rpa-paid-in-full@gmail.com

cmc-citizen-frontend:
  nodejs:
    image: hmcts.azurecr.io/hmcts/cmc-citizen-frontend:latest  # master
    ingressIP: ${INGRESS_IP}
    consulIP: ${CONSUL_LB_IP}
    releaseNameOverride: ${SERVICE_NAME}-nodejs
    readinessDelay: 90  # claim-store will start much slower
    livenessDelay: 90  # claim-store will start much slower
    registerAdditionalDns:
      enabled: true
      primaryIngressHost: ${SERVICE_FQDN}
      prefix: www
    environment:
      LOG_LEVEL: DEBUG
      FEATURE_TOGGLES_API_URL: http://${SERVICE_NAME}-ftr-tgl-api
      CLAIM_STORE_URL: http://${SERVICE_NAME}-java
      # TODO: bump frontend chart version (forgot when updated with sidam update)
      IDAM_API_URL: https://idam-api.aat.platform.hmcts.net
      IDAM_URL: https://idam-api.aat.platform.hmcts.net
      IDAM_AUTHENTICATION_WEB_URL: https://idam-web-public.aat.platform.hmcts.net
  rpe-feature-toggle-api:
    releaseNameOverride: ${SERVICE_NAME}-ftr-tgl-api
    importer:
      oneoff:
        command: /scripts/add-weighted-toggle.sh cmc_admissions 'CMC admissions' '1.0' ${ADMIN_USERNAME_TEST} ${ADMIN_PASSWORD_TEST} &&
          /scripts/add-toggle.sh cmc_defence_reminders 'CMC defence reminders' false ${ADMIN_USERNAME_TEST} ${ADMIN_PASSWORD_TEST}
    java:
      releaseNameOverride: ${SERVICE_NAME}-ftr-tgl-api
      environment:
        FEATURES_DB_HOST: ${SERVICE_NAME}-ccd-postgres

ccd:
  # TODO: update CCD chart with SIDAM
  idamApiUrl: https://idam-api.aat.platform.hmcts.net
  idamWebUrl: https://idam-web-public.aat.platform.hmcts.net
  ingressHost: ${SERVICE_FQDN}
  ingressIP: ${INGRESS_IP}
  consulIP: ${CONSUL_LB_IP}
  apiGateway:
    s2sKey: ${API_GATEWAY_S2S_KEY}
    idamClientSecret: ${API_GATEWAY_IDAM_SECRET}
  userProfileApi:
    authorisedServices: ccd_admin,ccd_data,ccd_definition,cmc_claim_store
  dataStoreApi:
    s2sKey: ${DATA_STORE_S2S_KEY}
    s2sAuthorisedServices: cmc_claim_store,ccd_gw
  definitionStoreApi:
    s2sKey: ${DEFINITION_STORE_S2S_KEY}
    s2sAuthorisedServices: ccd_admin,ccd_data,cmc_claim_store,ccd_gw
  caseManagementWeb:
    enabled: true
    environment:
      NODE_TLS_REJECT_UNAUTHORIZED: 0
  adminWeb:
    enabled: true
    s2sKey: ${ADMIN_S2S_KEY}
    idamClientSecret: ${ADMIN_WEB_IDAM_SECRET}
    environment:
      NODE_TLS_REJECT_UNAUTHORIZED: 0
      # TODO: add these to chart-ccd
      ADMINWEB_USER_ROLE_URL: http://${SERVICE_NAME}-definition-store-api/api/user-role
      ADMINWEB_DELETE_DEFINITION_URL: http://${SERVICE_NAME}-definition-store-api/api/draft
      ADMINWEB_ROLES_WHITELIST: 'ccd-import,ccd-import-validate'
  importer:
    userprofile:
      enabled: true
      jurisdictions:
        - CMC
      users:
        - civilmoneyclaims+ccd@gmail.com|CMC|MoneyClaimCase|open
      userProfileDatabaseHost: ${SERVICE_NAME}-ccd-postgres
      userProfileDatabasePort: 5432
      userProfileDatabaseUser: hmcts
      userProfileDatabasePassword: hmcts
      userProfileDatabaseName: user-profile
    definition:
      enabled: true
      image: hmcts.azurecr.io/hmcts/cmc-ccd-definition-importer
      definitionFilename: cmc-ccd.xlsx
      definitions:  # TODO: change chart-ccd to allow either definitions or definitionFilename
        -
      userRoles:
        - citizen
        - caseworker-cmc
        - caseworker-cmc-solicitor
        - caseworker-cmc-systemupdate
        - letter-holder
        - caseworker-autotest1
