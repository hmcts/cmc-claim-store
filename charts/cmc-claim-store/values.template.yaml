tags:
  - postgresql-pod
  - feature-toggle-api-pod
  - citizen-frontend-pod

postgresql:
  resources:
    requests:
      cpu: 25m
  initdbScripts:
    init.sql: |-
      CREATE USER claimstore WITH PASSWORD 'claimstore';
      CREATE DATABASE claimstore WITH OWNER = claimstore ENCODING = 'UTF-8' CONNECTION LIMIT = -1;
      CREATE USER cmc WITH PASSWORD 'cmc';
      CREATE DATABASE cmc WITH OWNER = cmc ENCODING = 'UTF-8' CONNECTION LIMIT = -1;
      CREATE USER features WITH PASSWORD 'features';
      CREATE DATABASE features WITH OWNER = features ENCODING = 'UTF-8' CONNECTION LIMIT = -1;
  nameOverride: claim-store-postgres
  persistence:
    enabled: false

claim-store:
  image: ${IMAGE_NAME}
  ingressHost: ${SERVICE_FQDN}
  applicationPort: 4400
  cpuRequests: 25m
  keyVaults:
    cmc:
      resourceGroup: cmc
      secrets:
        - AppInsightsInstrumentationKey
        - citizen-oauth-client-secret
        - claim-store-s2s-secret
        - anonymous-caseworker-username
        - anonymous-caseworker-password
        - system-update-username
        - system-update-password
        - notify-api-key
  environment:
    IDAM_S2S_AUTH_URL: http://rpe-service-auth-provider-aat.service.core-compute-aat.internal
    SEND_LETTER_URL: http://rpe-send-letter-service-aat.service.core-compute-aat.internal
    IDAM_API_URL: https://preprod-idamapi.reform.hmcts.net:3511
    PDF_SERVICE_URL: http://cmc-pdf-service-aat.service.core-compute-aat.internal
    DOCUMENT_MANAGEMENT_URL: http://dm-store-aat.service.core-compute-aat.internal
    REFORM_TEAM: cmc
    REFORM_SERVICE_NAME: claim-store
    REFORM_ENVIRONMENT: preview
    LOG_LEVEL: DEBUG
    CLAIM_STORE_DB_HOST: ${SERVICE_NAME}-claim-store-postgres
    CLAIM_STORE_DB_PORT: 5432
    CLAIM_STORE_DB_USERNAME: claimstore
    CLAIM_STORE_DB_PASSWORD: claimstore
    CLAIM_STORE_DB_NAME: claimstore
    CMC_DB_HOST: ${SERVICE_NAME}-claim-store-postgres
    CMC_DB_PORT: 5432
    CMC_DB_USERNAME: cmc
    CMC_DB_PASSWORD: cmc
    CMC_DB_NAME: cmc
    SPRING_MAIL_HOST: mta.reform.hmcts.net
    SPRING_MAIL_PORT: 25
    SPRING_MAIL_TEST_CONNECTION: false
    SPRING_MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_ENABLE: true
    SPRING_MAIL_PROPERTIES_MAIL_SMTP_SSL_TRUST: mta.reform.hmcts.net
    CLAIM_STORE_TEST_SUPPORT_ENABLED: true
    FEATURE_TOGGLES_EMAILTOSTAFF: true
    FEATURE_TOGGLES_CCD_ENABLED: false
    FEATURE_TOGGLES_CCD_ASYNC_ENABLED: false
    DOCUMENT_MANAGEMENT_CASEWORKERROLE: caseworker-cmc
    CORE_CASE_DATA_API_URL: false
    FRONTEND_BASE_URL: https://www-${SERVICE_FQDN}
    RESPOND_TO_CLAIM_URL: https://www-${SERVICE_FQDN}/first-contact/start
    STAFF_NOTIFICATIONS_RECIPIENT: civilmoneyclaims+staff-int-tests@gmail.com
    STAFF_NOTIFICATIONS_SENDER: noreply@reform.hmcts.net
    RPA_NOTIFICATIONS_SENDER: noreply@reform.hmcts.net
    RPA_NOTIFICATIONS_SEALEDCLAIMRECIPIENT: civilmoneyclaims+rpa-claim-issued@gmail.com
    RPA_NOTIFICATIONS_MORETIMEREQUESTEDRECIPIENT: civilmoneyclaims+rpa-more-time-requested@gmail.com
    RPA_NOTIFICATIONS_RESPONSERECIPIENT: civilmoneyclaims+rpa-defence-response@gmail.com
    RPA_NOTIFICATIONS_COUNTYCOURTJUDGEMENTRECIPIENT: civilmoneyclaims+rpa-county-court-judgement@gmail.com
    RPA_NOTIFICATIONS_PAIDINFULLRECIPIENT: civilmoneyclaims+rpa-paid-in-full@gmail.com

rpe-feature-toggle-api:
  releaseNameOverride: ${SERVICE_NAME}-ftr-tgl-api
  registerDns: false
  importer:
    cron:
      enabled: false
    oneoff:
      command: /scripts/add-weighted-toggle.sh cmc_admissions 'CMC admissions' '1.0'
        ${ADMIN_USERNAME_TEST} ${ADMIN_PASSWORD_TEST} && /scripts/add-toggle.sh cmc_defence_reminders
        'CMC defence reminders' false ${ADMIN_USERNAME_TEST} ${ADMIN_PASSWORD_TEST}
      enabled: true
      permissions: cmc-new-features-consent-given
  java:
    releaseNameOverride: ${SERVICE_NAME}-ftr-tgl-api
    environment:
      FEATURES_DB_HOST: ${SERVICE_NAME}-claim-store-postgres
  tags:
    postgresql-pod: false

nodejs:
  ingressIP: ${INGRESS_IP}
  consulIP: ${CONSUL_LB_IP}
  releaseNameOverride: ${SERVICE_NAME}-nodejs
  registerAdditionalDns:
    enabled: true
    primaryIngressHost: ${SERVICE_FQDN}
    prefix: www
  image: hmcts/cmc-citizen-frontend:latest  # master
  applicationPort: 3000
  memoryRequests: 256Mi
  cpuRequests: 25m
  memoryLimits: 512Mi
  cpuLimits: 1
  keyVaults:
    cmc:
      resourceGroup: cmc
      secrets:
        - os-postcode-lookup-api-key
        - AppInsightsInstrumentationKey
        - citizen-oauth-client-secret
        - cmc-s2s-secret
        - citizen-draft-store-primary
        - citizen-draft-store-secondary
        - citizen-cookie-encryption-key
        - staff-email
  environment:
    IDAM_API_URL: https://preprod-idamapi.reform.hmcts.net:3511
    IDAM_URL: https://preprod-idamapi.reform.hmcts.net:3511
    IDAM_AUTHENTICATION_WEB_URL: https://idam.preprod.ccidam.reform.hmcts.net
    IDAM_S2S_AUTH: http://rpe-service-auth-provider-aat.service.core-compute-aat.internal
    S2S_URL: http://rpe-service-auth-provider-aat.service.core-compute-aat.internal
    IDAM_S2S_AUTH_URL: http://rpe-service-auth-provider-aat.service.core-compute-aat.internal
    PAY_URL: http://payment-api-aat.service.core-compute-aat.internal
    FEES_URL: http://fees-register-api-aat.service.core-compute-aat.internal
    DRAFT_STORE_URL: http://draft-store-service-aat.service.core-compute-aat.internal
    CLAIM_STORE_URL: http://${SERVICE_NAME}-claim-store
    REFORM_TEAM: cmc
    REFORM_SERVICE_NAME: citizen-frontend
    REFORM_ENVIRONMENT: preview
    NODE_ENV: production
    UV_THREADPOOL_SIZE: 64
    GA_TRACKING_ID: UA-97111056-1
    SERVICE_SURVEY_URL: http://www.smartsurvey.co.uk/s/CMCMVPT1/
    FEEDBACK_SURVEY_URL: http://www.smartsurvey.co.uk/s/CMCMVPFB/
    REPORT_PROBLEM_SURVEY_URL: http://www.smartsurvey.co.uk/s/CMCMVPPB/
    FEATURE_TOGGLES_API_URL: http://${SERVICE_NAME}-ftr-tgl-api
    FEATURE_TESTING_SUPPORT: true
    FEATURE_NEW_FEATURES_CONSENT: true
    FEATURE_ADMISSIONS: true
    FEATURE_FINE_PRINT: true
    FEATURE_RETURN_ERROR_TO_USER: true
    FEATURE_MOCK_PAY: false
